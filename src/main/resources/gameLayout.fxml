<?xml version="1.0" encoding="UTF-8"?>

<?import com.comp2042.ui.GameOverPanel?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.Group?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import java.net.URL?>

<StackPane fx:controller="com.comp2042.controllers.GuiController"
           xmlns:fx="http://javafx.com/fxml"
           alignment="CENTER">

    <children>
        <!-- Whole console cluster, centered in the window -->
        <VBox alignment="CENTER" spacing="24.0"
              prefWidth="920.0" prefHeight="760.0"
              maxWidth="920.0" maxHeight="760.0">
            <padding>
                <Insets top="20.0" right="0.0" bottom="20.0" left="0.0"/>
            </padding>

            <children>

                <!-- ================= TOP AREA: HOLD | BOARD | NEXT ================= -->
                <GridPane alignment="CENTER" hgap="40.0">
                    <columnConstraints>
                        <!-- side columns narrower; center column fixed -->
                        <ColumnConstraints prefWidth="200.0" halignment="CENTER" hgrow="NEVER"/>
                        <ColumnConstraints prefWidth="360.0" halignment="CENTER" hgrow="NEVER"/>
                        <ColumnConstraints prefWidth="200.0" halignment="CENTER" hgrow="NEVER"/>
                    </columnConstraints>
                    <rowConstraints>
                        <RowConstraints minHeight="360.0" vgrow="NEVER"/>
                    </rowConstraints>

                    <children>

                        <!-- ===== LEFT COLUMN: HOLD + SCORE ===== -->
                        <VBox GridPane.columnIndex="0"
                              GridPane.rowIndex="0"
                              alignment="TOP_CENTER"
                              spacing="30.0"
                              maxHeight="Infinity"
                              fillWidth="false">
                            <children>

                                <!-- HOLD panel -->
                                <StackPane prefWidth="180.0" styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox alignment="TOP_CENTER" spacing="8.0">
                                                    <children>
                                                        <Label text="HOLD (C)"
                                                               styleClass="score-section-title"/>

                                                        <!-- Hold: one black window with centered brick -->
                                                        <StackPane alignment="CENTER">
                                                            <StackPane alignment="CENTER"
                                                                       prefWidth="120.0"
                                                                       prefHeight="80.0"
                                                                       styleClass="nextBrick">
                                                                <children>
                                                                    <VBox alignment="CENTER"
                                                                          fillWidth="false">
                                                                        <children>
                                                                            <!-- Grid that draws the hold piece -->
                                                                            <GridPane fx:id="holdBrickPanel"
                                                                                      hgap="1" vgap="1"/>
                                                                        </children>
                                                                    </VBox>
                                                                </children>
                                                            </StackPane>
                                                        </StackPane>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>

                                <!-- Spacer so SCORE pod sits near bottom of board -->
                                <Region VBox.vgrow="ALWAYS"/>

                                <!-- SCORE / LEVEL / LINES / COMBO pod -->
                                <StackPane prefWidth="180.0"
                                           styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox spacing="10.0" alignment="CENTER">
                                                    <children>
                                                        <Label text="SCORE" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="scoreText"
                                                                      text="0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="LEVEL" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="levelText"
                                                                      text="1"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="LINES" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="linesText"
                                                                      text="0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="COMBO" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="comboText"
                                                                      text="x0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>

                            </children>
                        </VBox>

                        <!-- =================== CENTRE: MAIN BOARD =================== -->
                        <StackPane GridPane.columnIndex="1"
                                   GridPane.rowIndex="0"
                                   alignment="CENTER"
                                   maxHeight="Infinity">
                            <children>

                                <!-- Board frame -->
                                <BorderPane fx:id="gameBoard"
                                            styleClass="gameBoard"
                                            prefWidth="360.0"
                                            prefHeight="640.0">
                                    <center>
                                        <GridPane fx:id="gamePanel"
                                                  hgap="1" vgap="1"/>
                                    </center>
                                </BorderPane>

                                <!-- Ghost piece overlay (影子方块) -->
                                <GridPane fx:id="ghostPanel"
                                          vgap="1" hgap="1"
                                          mouseTransparent="true"/>

                                <!-- Falling brick (overlay). brickPanel is positioned from controller -->
                                <GridPane fx:id="brickPanel" vgap="1" hgap="1"/>

                                <!-- Notifications -->
                                <Group fx:id="groupNotification"
                                       layoutX="14.0"
                                       layoutY="203.0"/>

                                <!-- Game Over overlay (covers entire game area like pause menu) -->
                                <GameOverPanel fx:id="gameOverPanel"
                                               visible="false"/>

                                <!-- Pause overlay -->
                                <StackPane fx:id="pauseOverlay"
                                           visible="false"
                                           alignment="CENTER">
                                    <!-- Semi-transparent background overlay -->
                                    <Region style="-fx-background-color: rgba(0,0,0,0.7);"
                                            maxWidth="Infinity"
                                            maxHeight="Infinity"/>
                                    
                                    <!-- Centered pause menu panel -->
                                    <VBox alignment="CENTER" spacing="24.0" styleClass="pause-menu-panel">
                                        <padding>
                                            <Insets top="40.0" right="50.0" bottom="40.0" left="50.0"/>
                                        </padding>
                                        
                                        <children>
                                            <Label text="PAUSED" styleClass="pause-title"/>
                                            
                                            <VBox alignment="CENTER" spacing="14.0">
                                                <Button fx:id="resumeButton"
                                                        text="Resume"
                                                        styleClass="pause-button"/>
                                                
                                                <Button fx:id="restartButton"
                                                        text="Restart"
                                                        styleClass="pause-button"/>
                                                
                                                <Button fx:id="pauseSettingsButton"
                                                        text="Settings"
                                                        styleClass="pause-button"/>
                                                
                                                <Button fx:id="pauseMenuButton"
                                                        text="Main Menu"
                                                        styleClass="pause-button"/>
                                            </VBox>
                                        </children>
                                    </VBox>
                                </StackPane>

                            </children>
                        </StackPane>

                        <!-- ===== RIGHT COLUMN: NEXT + INFO ===== -->
                        <VBox GridPane.columnIndex="2"
                              GridPane.rowIndex="0"
                              alignment="TOP_CENTER"
                              spacing="20.0"
                              maxHeight="Infinity">
                            <children>
                                <!-- NEXT shell -->
                                <StackPane prefWidth="180.0" styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox alignment="TOP_CENTER" spacing="8.0">
                                                    <children>

                                                        <Label text="NEXT"
                                                               styleClass="score-section-title"/>

                                                        <!-- ONE tall black window, 3 previews inside -->
                                                        <StackPane alignment="CENTER">
                                                            <StackPane alignment="CENTER"
                                                                       prefWidth="136.0"
                                                                       prefHeight="220.0"
                                                                       styleClass="nextBrick">
                                                                <padding>
                                                                    <Insets top="8.0" right="8.0" bottom="8.0" left="8.0"/>
                                                                </padding>
                                                                <children>
                                                                    <!-- Vertical stack for 3 mini-bricks -->
                                                                    <VBox alignment="CENTER"
                                                                          spacing="30.0"
                                                                          fillWidth="false">
                                                                        <children>
                                                                            <!-- Top preview -->
                                                                            <GridPane fx:id="nextBrickPanelTop"
                                                                                      hgap="1" vgap="1"/>

                                                                            <!-- Middle preview -->
                                                                            <GridPane fx:id="nextBrickPanelMid"
                                                                                      hgap="1" vgap="1"/>

                                                                            <!-- Bottom preview -->
                                                                            <GridPane fx:id="nextBrickPanelBottom"
                                                                                      hgap="1" vgap="1"/>
                                                                        </children>
                                                                    </VBox>
                                                                </children>
                                                            </StackPane>
                                                        </StackPane>

                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>

                                <!-- Spacer so INFO panel sits near bottom of board -->
                                <Region VBox.vgrow="ALWAYS"/>

                                <!-- MODE / BEST / TIME / PAUSE panel (right-bottom) -->
                                <StackPane prefWidth="180.0"
                                           styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox spacing="6.0" alignment="CENTER_LEFT">
                                                    <children>
                                                        <!-- display message-->
                                                        <Text fx:id="modeText"
                                                              text="Mode: Classic"
                                                              styleClass="hud-value"/>

                                                        <Text fx:id="bestText"
                                                              text="Best Score 0"
                                                              styleClass="hud-value"/>

                                                        <Text fx:id="timerText"
                                                              text=""
                                                              styleClass="hud-value"/>

                                                        <Button text="PAUSE"
                                                                onAction="#pauseGame"
                                                                maxWidth="Infinity"
                                                                styleClass="ipad-dark-grey"/>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>
                            </children>
                        </VBox>

                    </children>
                </GridPane>

            </children>
        </VBox>
    </children>

    <stylesheets>
        <URL value="@window_style.css"/>
    </stylesheets>
</StackPane>
