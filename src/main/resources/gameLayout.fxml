<?xml version="1.0" encoding="UTF-8"?>

<?import com.comp2042.GameOverPanel?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.Group?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import java.net.URL?>

<!-- Main game screen. GuiController is the brain behind this layout.
     Root StackPane fills the window; a centred VBox groups all game UI
     so it feels like a single machine panel in the middle. -->
<StackPane fx:controller="com.comp2042.GuiController"
           xmlns:fx="http://javafx.com/fxml">

    <children>
        <!-- Vertical layout in the centre: TOP HUD row, BOARD, BOTTOM HUD row. -->
        <VBox alignment="CENTER" spacing="30.0">
            <children>

                <!-- TOP HUD row: HOLD (left) and NEXT (right). -->
                <HBox alignment="CENTER" spacing="80.0">
                    <!-- HOLD panel: label + GridPane reserved for hold preview. -->
                    <VBox spacing="10.0" alignment="TOP_CENTER">
                        <padding>
                            <Insets top="10.0" left="0.0" right="0.0" bottom="0.0"/>
                        </padding>
                        <children>
                            <Label text="HOLD (C)"
                                   styleClass="nextBrickLabel"/>
                            <GridPane fx:id="holdBrickPanel"
                                      hgap="1" vgap="1"
                                      prefWidth="88.0"
                                      prefHeight="88.0"
                                      styleClass="nextBrick"/>
                        </children>
                    </VBox>

                    <!-- NEXT preview panel (already wired in GuiController). -->
                    <VBox spacing="10.0" alignment="TOP_CENTER">
                        <padding>
                            <Insets top="10.0" left="0.0" right="0.0" bottom="0.0"/>
                        </padding>
                        <children>
                            <Label text="NEXT" styleClass="nextBrickLabel"/>
                            <GridPane fx:id="nextBrickPanel"
                                      hgap="1" vgap="1"
                                      styleClass="nextBrick"/>
                        </children>
                    </VBox>
                </HBox>

                <!-- CENTRE: game board, falling pieces, notifications and pause overlay. -->
                <Group>
                    <children>

                        <!-- Grid used to display the current falling brick. -->
                        <GridPane fx:id="brickPanel" vgap="1" hgap="1"/>

                        <!-- Outer frame for the main board (border, glow, etc.). -->
                        <BorderPane styleClass="gameBoard" fx:id="gameBoard">
                            <center>
                                <!-- Actual 10xN board where the pieces fall. -->
                                <GridPane fx:id="gamePanel"
                                          hgap="1" vgap="1"
                                          layoutY="30.0" layoutX="40.0"/>
                            </center>
                        </BorderPane>

                        <!-- Used for pop-up messages (score, etc.) and the GameOverPanel. -->
                        <Group fx:id="groupNotification" layoutX="14.0" layoutY="203.0">
                            <children>
                                <VBox alignment="CENTER">
                                    <GameOverPanel fx:id="gameOverPanel"/>
                                </VBox>
                            </children>
                        </Group>

                        <!-- Pause overlay: dim background + small pause menu. Always on top. -->
                        <Pane fx:id="pauseOverlay"
                              layoutX="0.0" layoutY="0.0"
                              prefWidth="400.0" prefHeight="500.0"
                              visible="false"
                              style="-fx-background-color: rgba(0,0,0,0.5);">
                            <children>
                                <VBox alignment="CENTER" spacing="10" layoutX="60.0" layoutY="180.0">
                                    <Label text="PAUSED" styleClass="gameOverStyle"/>

                                    <!-- Buttons only have fx:id; actions are wired in GuiController. -->
                                    <Button fx:id="resumeButton"
                                            text="Resume"
                                            styleClass="ipad-dark-grey"/>

                                    <Button fx:id="restartButton"
                                            text="Restart"
                                            styleClass="ipad-dark-grey"/>

                                    <Button fx:id="pauseMenuButton"
                                            text="Main Menu"
                                            styleClass="ipad-dark-grey"/>
                                </VBox>
                            </children>
                        </Pane>

                    </children>
                </Group>

                <!-- BOTTOM HUD row: mode / score / level / time / progress / best / combo / danger + controls hint. -->
                <HBox alignment="CENTER" spacing="80.0">
                    <VBox spacing="5.0" alignment="TOP_LEFT" styleClass="hud-box">
                        <padding>
                            <Insets top="10.0" right="20.0" bottom="0.0" left="20.0"/>
                        </padding>
                        <children>
                            <!-- Mode label: set dynamically from GameMode. -->
                            <Text fx:id="modeText" text="Mode: Classic" styleClass="hud-value"/>

                            <!-- New: per-mode hint line (set by GuiController). -->
                            <Text fx:id="modeHintText"
                                  text="Classic: standard Tetris rules."
                                  styleClass="hud-value"/>

                            <Text fx:id="scoreText" text="Score 0" styleClass="hud-value"/>
                            <Text fx:id="levelText" text="Level 1" styleClass="hud-value"/>
                            <Text fx:id="timerText" text="Time 00:00" styleClass="hud-value"/>

                            <!-- Generic progress line used differently per mode (Rush / Survival, etc.). -->
                            <Text fx:id="progressText" text="" styleClass="hud-value"/>

                            <!-- Best record line (score, and time for Rush-40). -->
                            <Text fx:id="bestText" text="Best Score 0" styleClass="hud-value"/>

                            <Text fx:id="comboText" text="Combo x0" styleClass="hud-value"/>
                            <Text fx:id="dangerText"
                                  text="DANGER!"
                                  visible="false"
                                  styleClass="dangerText hud-value hud-danger"/>

                            <!-- Simple control hint so players know how to use hold. -->
                            <Text text="Controls: ← → move, ↑ rotate, ↓ soft drop, C hold/swap"
                                  styleClass="hud-value"/>
                        </children>
                    </VBox>
                </HBox>

            </children>
        </VBox>
    </children>

    <!-- Global styles for this scene (board border, fonts, colours, etc.). -->
    <stylesheets>
        <URL value="@window_style.css"/>
    </stylesheets>
</StackPane>
