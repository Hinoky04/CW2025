<?xml version="1.0" encoding="UTF-8"?>

<?import com.comp2042.GameOverPanel?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.Group?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import java.net.URL?>

<StackPane fx:controller="com.comp2042.GuiController"
           xmlns:fx="http://javafx.com/fxml"
           alignment="CENTER">

    <children>
        <!-- Whole console cluster, centered in the window -->
        <VBox alignment="CENTER" spacing="24.0"
              prefWidth="920.0" prefHeight="760.0"
              maxWidth="920.0" maxHeight="760.0">
            <padding>
                <Insets top="20.0" right="0.0" bottom="20.0" left="0.0"/>
            </padding>

            <children>

                <!-- ================= TOP AREA: HOLD | BOARD | NEXT ================= -->
                <GridPane alignment="CENTER" hgap="40.0"
                          scaleX="1.10" scaleY="1.10">
                    <columnConstraints>
                        <!-- side columns narrower; center column fixed -->
                        <ColumnConstraints prefWidth="200.0" halignment="CENTER" hgrow="NEVER"/>
                        <ColumnConstraints prefWidth="360.0" halignment="CENTER" hgrow="NEVER"/>
                        <ColumnConstraints prefWidth="200.0" halignment="CENTER" hgrow="NEVER"/>
                    </columnConstraints>
                    <rowConstraints>
                        <RowConstraints minHeight="360.0" vgrow="NEVER"/>
                    </rowConstraints>

                    <children>

                        <!-- ===== LEFT COLUMN: HOLD (top) + SCORE (bottom) ===== -->
                        <VBox GridPane.columnIndex="0"
                              GridPane.rowIndex="0"
                              alignment="TOP_CENTER"
                              spacing="14.0"
                              maxHeight="Infinity"
                              fillWidth="false">
                            <children>

                                <!-- HOLD panel: outer shell now EXACTLY same as SCORE (panel-frame-square + score-panel) -->
                                <StackPane prefWidth="180.0" styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox alignment="TOP_CENTER" spacing="8.0">
                                                    <children>
                                                        <Label text="HOLD (C)"
                                                               styleClass="score-section-title"/>

                                                        <!-- Center the preview window -->
                                                        <StackPane alignment="CENTER">
                                                            <GridPane fx:id="holdBrickPanel"
                                                                      hgap="1" vgap="1"
                                                                      prefWidth="80.0" prefHeight="80.0"
                                                                      styleClass="nextBrick"/>
                                                        </StackPane>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>

                                <!-- Spacer so SCORE pod sits near bottom of board -->
                                <Region VBox.vgrow="ALWAYS"/>

                                <!-- SCORE / LEVEL / LINES / COMBO pod -->
                                <StackPane prefWidth="180.0"
                                           styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox spacing="10.0" alignment="CENTER">
                                                    <children>
                                                        <Label text="SCORE" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="scoreText"
                                                                      text="0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="LEVEL" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="levelText"
                                                                      text="1"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="LINES" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="linesText"
                                                                      text="0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>

                                                        <Label text="COMBO" styleClass="score-section-title"/>
                                                        <StackPane styleClass="score-slot">
                                                            <children>
                                                                <Text fx:id="comboText"
                                                                      text="x0"
                                                                      fill="WHITE"
                                                                      styleClass="hud-value score-digit"/>
                                                            </children>
                                                        </StackPane>
                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>

                            </children>
                        </VBox>

                        <!-- =================== CENTRE: MAIN BOARD =================== -->
                        <StackPane GridPane.columnIndex="1"
                                   GridPane.rowIndex="0"
                                   alignment="CENTER"
                                   maxHeight="Infinity">
                            <children>
                                <Group>
                                    <children>

                                        <!-- Board frame -->
                                        <BorderPane fx:id="gameBoard"
                                                    styleClass="gameBoard"
                                                    prefWidth="360.0"
                                                    prefHeight="640.0">
                                            <center>
                                                <GridPane fx:id="gamePanel"
                                                          hgap="1" vgap="1"
                                                          layoutY="30.0" layoutX="40.0"/>
                                            </center>
                                        </BorderPane>

                                        <!-- Falling brick -->
                                        <GridPane fx:id="brickPanel" vgap="1" hgap="1"/>

                                        <!-- Notifications + GameOverPanel -->
                                        <Group fx:id="groupNotification"
                                               layoutX="14.0"
                                               layoutY="203.0">
                                            <children>
                                                <VBox alignment="CENTER">
                                                    <GameOverPanel fx:id="gameOverPanel"/>
                                                </VBox>
                                            </children>
                                        </Group>

                                        <!-- Pause overlay -->
                                        <Pane fx:id="pauseOverlay"
                                              layoutX="0.0" layoutY="0.0"
                                              visible="false"
                                              style="-fx-background-color: rgba(0,0,0,0.5);">
                                            <children>
                                                <VBox alignment="CENTER" spacing="10.0"
                                                      layoutX="60.0" layoutY="180.0">
                                                    <Label text="PAUSED" styleClass="gameOverStyle"/>

                                                    <Button fx:id="resumeButton"
                                                            text="Resume"
                                                            styleClass="ipad-dark-grey"/>

                                                    <Button fx:id="restartButton"
                                                            text="Restart"
                                                            styleClass="ipad-dark-grey"/>

                                                    <Button fx:id="pauseMenuButton"
                                                            text="Main Menu"
                                                            styleClass="ipad-dark-grey"/>
                                                </VBox>
                                            </children>
                                        </Pane>

                                    </children>
                                </Group>
                            </children>
                        </StackPane>

                        <!-- ===== RIGHT COLUMN: NEXT column ===== -->
                        <VBox GridPane.columnIndex="2"
                              GridPane.rowIndex="0"
                              alignment="TOP_CENTER"
                              spacing="14.0"
                              maxHeight="Infinity">
                            <children>
                                <!-- NEXT shell now also uses panel-frame-square + score-panel -->
                                <StackPane prefWidth="180.0" styleClass="panel-frame-square score-panel">
                                    <padding>
                                        <Insets top="6.0" right="6.0" bottom="6.0" left="6.0"/>
                                    </padding>
                                    <children>
                                        <StackPane styleClass="score-inner-frame">
                                            <padding>
                                                <Insets top="10.0" right="10.0" bottom="10.0" left="10.0"/>
                                            </padding>
                                            <children>
                                                <VBox alignment="TOP_CENTER" spacing="8.0">
                                                    <children>

                                                        <Label text="NEXT"
                                                               styleClass="score-section-title"/>

                                                        <!-- three next previews, each centered -->
                                                        <VBox alignment="CENTER" spacing="10.0">
                                                            <children>

                                                                <StackPane alignment="CENTER">
                                                                    <GridPane fx:id="nextBrickPanelTop"
                                                                              hgap="1" vgap="1"
                                                                              prefWidth="80.0" prefHeight="80.0"
                                                                              styleClass="nextBrick"/>
                                                                </StackPane>

                                                                <StackPane alignment="CENTER">
                                                                    <GridPane fx:id="nextBrickPanelMid"
                                                                              hgap="1" vgap="1"
                                                                              prefWidth="80.0" prefHeight="80.0"
                                                                              styleClass="nextBrick"/>
                                                                </StackPane>

                                                                <StackPane alignment="CENTER">
                                                                    <GridPane fx:id="nextBrickPanelBottom"
                                                                              hgap="1" vgap="1"
                                                                              prefWidth="80.0" prefHeight="80.0"
                                                                              styleClass="nextBrick"/>
                                                                </StackPane>

                                                            </children>
                                                        </VBox>

                                                    </children>
                                                </VBox>
                                            </children>
                                        </StackPane>
                                    </children>
                                </StackPane>
                            </children>
                        </VBox>

                    </children>
                </GridPane>

                <!-- Bottom HUD kept for controller, hidden from player -->
                <HBox alignment="CENTER" spacing="30.0"
                      visible="false" managed="false">
                    <children>
                        <VBox spacing="5.0" alignment="TOP_LEFT">
                            <children>
                                <Text fx:id="modeText"
                                      text="Mode: Classic"
                                      styleClass="hud-value hud-title"/>

                                <Text fx:id="modeHintText"
                                      text="Classic: standard Tetris rules."
                                      styleClass="hud-value hud-subtitle"/>

                                <Text fx:id="timerText"
                                      text="Time 00:00"
                                      styleClass="hud-value"/>

                                <Text fx:id="progressText"
                                      text=""
                                      styleClass="hud-value"/>

                                <Text fx:id="dangerText"
                                      text="DANGER!"
                                      visible="false"
                                      styleClass="dangerText hud-value hud-danger"/>
                            </children>
                        </VBox>
                    </children>
                </HBox>

            </children>
        </VBox>
    </children>

    <stylesheets>
        <URL value="@window_style.css"/>
    </stylesheets>
</StackPane>
